<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yes Streak Widget</title>
<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#6b7280; --card:#f3f4f6; --accent:#2563eb; --accent-weak:#dbeafe;
    --radius:16px;
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0b0f14; --fg:#e5e7eb; --muted:#94a3b8; --card:#0f172a; --accent:#60a5fa; --accent-weak:#1e293b; }
  }
  html,body{height:100%}
  body{
    margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background:var(--bg); color:var(--fg); display:grid; place-items:center; padding:18px;
  }
  .widget{
    width:min(500px, 100%); border:1px solid rgba(0,0,0,.08); border-radius:var(--radius);
    background:var(--card); box-shadow:0 6px 30px rgba(0,0,0,.14); overflow:hidden;
  }
  .header{
    display:flex; align-items:center; gap:10px; padding:16px 18px; background:var(--accent-weak);
    border-bottom:1px solid rgba(0,0,0,.06);
  }
  .header .emoji{font-size:22px}
  .title{font-weight:700}
  .content{padding:18px}
  .stats{
    display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px;
  }
  .card{
    background:var(--bg); border:1px dashed rgba(0,0,0,.14); border-radius:12px; padding:14px; text-align:center;
  }
  .label{font-size:12px; color:var(--muted); letter-spacing:.02em; text-transform:uppercase}
  .value{font-size:36px; font-weight:800; margin-top:6px}
  .btn{
    width:100%; padding:14px 16px; border:none; border-radius:12px; font-weight:700; font-size:16px;
    cursor:pointer; background:var(--accent); color:white;
  }
  .btn:active{transform:translateY(1px)}
  .hint{margin-top:10px; font-size:12px; color:var(--muted)}
  .row{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px}
  .ghost{background:transparent; border:1px solid rgba(0,0,0,.15); color:var(--fg)}
  .callout{
    margin-top:12px; padding:14px; border-radius:12px; background:var(--bg); border-left:6px solid var(--accent);
  }
  .small{font-size:12px; color:var(--muted)}
  a{color:inherit}
</style>
</head>
<body>
  <div class="widget" id="app">
    <div class="header">
      <div class="emoji" id="emoji">ðŸ”¥</div>
      <div class="title" id="title">Yes Streak</div>
    </div>
    <div class="content">
      <div class="stats">
        <div class="card">
          <div class="label">Current Streak</div>
          <div class="value" id="streak">0</div>
          <div class="small" id="streakDetail"></div>
        </div>
        <div class="card">
          <div class="label">Total Yes</div>
          <div class="value" id="total">0</div>
          <div class="small" id="lastYes">â€”</div>
        </div>
      </div>

      <button class="btn" id="yesBtn">Yes for Today</button>
      <div class="row">
        <button class="btn ghost" id="undoBtn" title="Remove todayâ€™s yes">Undo Today</button>
        <button class="btn ghost" id="resetBtn" title="Clear all data">Reset</button>
      </div>

      <div class="callout" id="callout">
        <strong>Streak:</strong> <span id="calloutStreak">0</span> days â€” keep it going! ðŸ’ª
      </div>
      <div class="hint">Tip: this widget stores data in your browser with <code>localStorage</code>. Each viewer has their own streak.</div>
    </div>
  </div>

<script>
(function(){
  // --- Config via URL params (optional) ---
  const params = new URLSearchParams(location.search);
  const WIDGET_ID = params.get("id") || "default";
  const TITLE = params.get("title") || "Yes Streak";
  const EMOJI = params.get("emoji") || "ðŸ”¥";

  document.getElementById("title").textContent = TITLE;
  document.getElementById("emoji").textContent = EMOJI;

  // --- Storage helpers ---
  const KEY = `yes-streak::${WIDGET_ID}`;
  const todayStr = () => new Date().toISOString().slice(0,10); // yyyy-mm-dd

  function loadData(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return { days: [] };
      const obj = JSON.parse(raw);
      // Ensure unique, sorted dates
      const uniq = Array.from(new Set((obj.days||[]))).sort();
      return { days: uniq };
    }catch(e){ return { days: [] }; }
  }

  function saveData(days){
    const uniq = Array.from(new Set(days)).sort();
    localStorage.setItem(KEY, JSON.stringify({ days: uniq }));
    return uniq;
  }

  function addToday(){
    const d = loadData().days;
    if(!d.includes(todayStr())) d.push(todayStr());
    saveData(d); render();
  }

  function undoToday(){
    const d = loadData().days.filter(x => x !== todayStr());
    saveData(d); render();
  }

  function resetAll(){
    localStorage.removeItem(KEY); render();
  }

  // --- Streak math ---
  function dateMinus(dateStr, days){
    const d = new Date(dateStr + "T00:00:00Z");
    d.setUTCDate(d.getUTCDate() - days);
    return d.toISOString().slice(0,10);
  }

  function calcStreak(days){
    if(days.length === 0) return 0;
    // Count consecutive days ending today; if no "today", allow streak to end yesterday
    const haveToday = days.includes(todayStr());
    const startFrom = haveToday ? todayStr() : dateMinus(todayStr(), 1);
    let streak = 0;
    while(days.includes(dateMinus(startFrom, streak))) streak++;
    return streak;
  }

  // --- Render ---
  function render(){
    const { days } = loadData();
    const total = days.length;
    const streak = calcStreak(days);
    const last = days[days.length - 1];

    // UI
    document.getElementById("total").textContent = total;
    document.getElementById("streak").textContent = streak;
    document.getElementById("calloutStreak").textContent = streak;

    document.getElementById("streakDetail").textContent =
      streak > 0 ? `Consecutive ${streak} day${streak>1?'s':''}` : 'No active streak';

    document.getElementById("lastYes").textContent =
      last ? `Last yes: ${last}` : 'No logs yet';

    // Button state
    const hasToday = days.includes(todayStr());
    document.getElementById("yesBtn").disabled = hasToday;
    document.getElementById("yesBtn").textContent = hasToday ? "Already marked today âœ…" : "Yes for Today";
  }

  // --- Events ---
  document.getElementById("yesBtn").addEventListener("click", addToday);
  document.getElementById("undoBtn").addEventListener("click", undoToday);
  document.getElementById("resetBtn").addEventListener("click", () => {
    if(confirm("Reset all streak data for this widget?")) resetAll();
  });

  render();
})();
</script>
</body>
</html>
