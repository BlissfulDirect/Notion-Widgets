<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Job Apply Widget</title>
<style>
:root{
  --bg:#ffffff; --fg:#0f172a; --muted:#64748b; --card:#f8fafc; --accent:#2563eb; --accent-weak:#dbeafe;
  --ok:#16a34a; --warn:#f59e0b; --danger:#ef4444; --radius:10px;
}
@media (prefers-color-scheme: dark){
  :root{ --bg:#0b0f14; --fg:#e5e7eb; --muted:#94a3b8; --card:#0f172a; --accent:#60a5fa; --accent-weak:#1e293b; }
}
body{
  margin:0; background:var(--bg); color:var(--fg);
  font:12px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  display:grid; place-items:center; padding:6px;
}
.widget{
  width:230px; background:var(--card);
  border:1px solid rgba(0,0,0,.06); border-radius:var(--radius);
  box-shadow:0 3px 10px rgba(0,0,0,.12); overflow:hidden;
}
.header{
  display:flex; align-items:center; gap:4px; padding:6px 8px; background:var(--accent-weak);
  border-bottom:1px solid rgba(0,0,0,.08);
}
.emoji{font-size:14px}
.title{font-weight:600; font-size:12px}
.content{padding:8px}
.card{
  background:var(--bg); border:1px dashed rgba(0,0,0,.15); border-radius:6px; padding:4px; text-align:center; margin-bottom:6px;
}
.label{font-size:9px; color:var(--muted); text-transform:uppercase}
.value{font-size:18px; font-weight:700}
.timer{
  margin:4px 0 6px; font-size:18px; font-weight:700; text-align:center;
  background:var(--bg); border:1px solid rgba(0,0,0,.08); border-radius:6px; padding:4px;
}
.row{display:flex; gap:4px; margin-top:4px}
.btn{
  flex:1; padding:6px; border:none; border-radius:6px; font-weight:600; font-size:11px; cursor:pointer;
  background:var(--accent); color:#fff;
}
.btn:disabled{opacity:.6; cursor:not-allowed}
.ghost{background:transparent; color:var(--fg); border:1px solid rgba(0,0,0,.15)}
.ok{background:var(--ok)}
.warn{background:var(--warn)}
.danger{background:var(--danger)}
.callout{
  margin-top:6px; padding:6px; border-radius:6px; background:var(--bg); border-left:3px solid var(--accent);
  font-size:11px;
}
.small{font-size:9px; color:var(--muted)}
</style>
</head>
<body>
  <div class="widget" id="app">
    <div class="header">
      <div class="emoji" id="emoji">ðŸ“„</div>
      <div class="title" id="title">Job Apply</div>
    </div>
    <div class="content">
      <div class="card">
        <div class="label">Completed Sessions</div>
        <div class="value" id="count">0</div>
        <div class="small" id="lastDone">â€”</div>
      </div>

      <div class="timer" id="timer">20:00</div>

      <div class="row">
        <button class="btn" id="startBtn">Start</button>
        <button class="btn ok" id="completeBtn" disabled>Done</button>
      </div>
      <div class="row">
        <button class="btn warn" id="pauseBtn" disabled>Pause</button>
        <button class="btn ghost" id="cancelBtn" disabled>Cancel</button>
      </div>
      <div class="row">
        <button class="btn danger" id="resetBtn">Reset</button>
      </div>

      <div class="callout">
        <strong>Streak:</strong> <span id="calloutCount">0</span> sessions ðŸŽ¯
      </div>
    </div>
  </div>

<script>
(function () {
  const p = new URLSearchParams(location.search);
  const TITLE = p.get("title") || "Job Apply";
  const EMOJI = p.get("emoji") || "ðŸ“„";
  const MINUTES = Math.max(1, parseInt(p.get("mins") || "20", 10));
  const ID = p.get("id") || "job-apply";

  document.getElementById("title").textContent = TITLE;
  document.getElementById("emoji").textContent = EMOJI;

  const KEY = `apply-widget::${ID}`;
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY))||{count:0,lastDone:null,active:null}; }catch{return{count:0,lastDone:null,active:null}}}
  function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

  let state = load(), tick=null;
  const $count=document.getElementById("count"), $last=document.getElementById("lastDone"),
        $timer=document.getElementById("timer"), $callout=document.getElementById("calloutCount"),
        $start=document.getElementById("startBtn"), $pause=document.getElementById("pauseBtn"),
        $cancel=document.getElementById("cancelBtn"), $done=document.getElementById("completeBtn"),
        $reset=document.getElementById("resetBtn");

  $start.onclick=start; $pause.onclick=()=>state.active.paused?resume():pause();
  $cancel.onclick=cancel; $done.onclick=complete; $reset.onclick=resetAll;

  function start(){
    if(state.active)return;
    state.active={started:Date.now(),remaining:MINUTES*60000}; save(state); tickLoop(); render();
  }
  function pause(){ state.active.paused=Date.now(); stopTick(); save(state); render(); }
  function resume(){ const d=Date.now()-state.active.paused; state.active.remaining-=d; delete state.active.paused; save(state); tickLoop(); render(); }
  function cancel(){ stopTick(); state.active=null; save(state); render(); }
  function complete(){ stopTick(); state.count++; state.lastDone=new Date().toISOString(); state.active=null; save(state); render(); }
  function resetAll(){ if(confirm("Reset streak?")){ state={count:0,lastDone:null,active:null}; save(state); render(); } }

  function tickLoop(){ stopTick(); tick=setInterval(()=>{ if(!state.active||state.active.paused)return;
    state.active.remaining=Math.max(0,state.active.remaining-1000);
    if(state.active.remaining<=0){complete();return;}
    save(state); renderTimer(); },1000);}
  function stopTick(){ if(tick)clearInterval(tick); tick=null;}
  function fmt(ms){const s=Math.round(ms/1000);return `${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;}
  function renderTimer(){ const t=state.active?state.active.remaining:MINUTES*60000; $timer.textContent=fmt(t);}
  function render(){ $count.textContent=state.count; $callout.textContent=state.count;
    $last.textContent=state.lastDone?`Last: ${state.lastDone.slice(0,16).replace("T"," ")}`:"â€”";
    const run=!!state.active, paused=run&&state.active.paused;
    $start.disabled=run; $pause.disabled=!run; $cancel.disabled=!run; $done.disabled=!run;
    $pause.textContent=paused?"Resume":"Pause"; renderTimer();}
  (function restore(){ if(state.active&&!state.active.paused){ const elapsed=Date.now()-state.active.started; state.active.remaining=Math.max(0,MINUTES*60000-elapsed); if(state.active.remaining<=0){complete();return;} tickLoop(); } render(); })();
})();
</script>
</body>
</html>

